<!DOCTYPE html>
<html xmlns:th="https://www.thymeleaf.org/"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{layout/layout}">
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
<link th:href="@{/user/css/trade.css}" rel="stylesheet" type="text/css">
<style>
.card {
	border: none;
	box-shadow: none;
}
</style>
</head>
<body>
	<div layout:fragment="content">
		<div class="card">
			<div class="card-body">
				<form class="row g-3" th:action="@{/member/tradeInsert}"
					method="POST" th:object="${tradeVO}">
					<div class="col-md-12 writeInput">
						<label for="title" class="form-label">제목<span class="star">*</span></label>
						<input type="text" class="form-control" id="title" placeholder="제목을 입력하세요" required th:field="*{title}">
					</div>
					<div class="col-md-3 writeInput">
						<label for="tradeCategory" class="form-label">상품카테고리<span class="star">*</span></label> 
						<select id="tradeCategory" class="form-select" required th:field="*{tradeCategory}">
							<option selected value="">선택하세요</option>
							<option value="TB1">생활용품</option>
							<option value="TB2">의류</option>
							<option value="TB3">식품</option>
							<option value="TB4">반려용품</option>
							<option value="TB5">도서</option>
							<option value="TB6">문구</option>
							<option value="TB7">가구</option>
							<option value="TB8">기타</option>
						</select>
					</div>
					<div class="col-md-3 writeInput">
						<label for="tradeType" class="form-label">거래방식<span class="star">*</span></label> 
						<select id="tradeType" class="form-select" required th:field="*{tradeType}">
							<option selected value="">선택하세요</option>
							<option value="TA1">직거래</option>
							<option value="TA2">비대면</option>
						</select>
					</div>
					<div class="col-md-3 writeInput">
						<label for="paymentType" class="form-label">결제방식<span class="star">*</span></label> 
						<select id="paymentType" class="form-select" required th:field="*{paymentType}">
							<option selected value="">선택하세요</option>
							<option value="TC1">현금결제</option>
							<option value="TC2">홀로페이</option>
						</select>
					</div>
					<div class="col-md-3 writeInput">
						<label for="price" class="form-label">금액</label> <input
							type="number" class="form-control" id="price" th:field="*{price}"><span
							class="priceUnit">원</span>
					</div>
					<div class="col-12 writeInput">
						<label for="description" class="form-label">상품 설명<span class="star">*</span></label>
						<textarea class="form-control" id="description" style="height: 300px;" required th:field="*{description}"></textarea>
					</div>
					<div class="col-12 writeInput">
						<div class="input-group mb-3">
							<span class="input-group-text" id="openKakao">오픈 카카오톡 주소<span class="star">*</span></span> 
							<input type="text" class="form-control" id="openKakao" aria-describedby="basic-addon3" required th:field="*{openKakao}">
						</div>
					</div>
					<div class="col-md-12 writeInput">
						<label for="tradeImg" class="form-label">상품사진<span class="star">*</span></label>
						<div>
							<img class="tradeImgPlus" id="tradeImg" th:src="@{/user/images/trade/photo.png}"> 
							<input class="real_file" type="file" onchange="addFile(this);" required multiple />
							<div class="file-list"></div>
						</div>

					</div>
					<div class="col-md-3 writeInput placeSelect">
						<div>
							<label for="tradePlace" class="form-label">거래희망장소</label>
						</div>
						<div class="placeSelectButton" id="tradePlace">
							<p>장소 선택 ></p>
						</div>
					</div>
					<div class="col-md-12 writeInput buttonFrom">
						<button type="reset" class="btn btn-secondary">취소</button>
						<button type="submit" class="btn btn-primary">등록</button>
					</div>
				</form>
			</div>
		</div>
		<script
			src="//t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>
		<script
			src="//dapi.kakao.com/v2/maps/sdk.js?appkey=App key 입력해라~&libraries=services"></script>
		<script>
			document.getElementById('tradePlace').addEventListener('click', function(){
				let width = 500; //팝업의 너비
				let height = 600; //팝업의 높이
				let geocoder = new daum.maps.services.Geocoder();
				let tradePlace = '';
				let latitude = '';
				let longitude = '';
				let input = '';
				new daum.Postcode({
			        oncomplete: function(data) {
			        	tradePlace = data.address; // 최종 주소 변수
			        	geocoder.addressSearch(data.address, function(results, status) {
		                    // 정상적으로 검색이 완료됐으면
		                    if (status === daum.maps.services.Status.OK) {
		                        let result = results[0];
		                        latitude = result.y;
		                        longitude = result.x;
		                    }
			        	});
			        },
			        onclose: function(state) {
			        	let placeSelect = document.querySelector('.placeSelect');
			        	if(document.getElementsByClassName('tradePlaceSelect').length == 0){
                           placeInput = document.createElement('input');
                           placeInput.setAttribute("type", "text");
                           placeInput.classList.add('form-control', 'tradePlaceSelect');
                           placeInput.setAttribute("id","tradePlace");
                           placeSelect.appendChild(placeInput);
                           
                           latitudeInput = document.createElement('input');
                           latitudeInput.setAttribute("type", "text");
                           latitudeInput.style.display = 'none';
                           latitudeInput.setAttribute("id","latitude");
                           placeSelect.appendChild(latitudeInput);
                           
                           longitudeInput = document.createElement('input');
                           longitudeInput.setAttribute("type", "text");
                           longitudeInput.style.display = 'none';
                           longitudeInput.setAttribute("id","longitude");
                           placeSelect.appendChild(longitudeInput);
                        }
                        document.querySelector('.tradePlaceSelect').value = tradePlace;
                        document.querySelector('.tradePlaceSelect').name = tradePlace;
                        document.querySelector('#latitude').value = latitude
                        document.querySelector('#latitude').name = latitude;
                        document.querySelector('#longitude').value = longitude;
                        document.querySelector('#longitude').name = longitude;
			        },
					theme: {
						searchBgColor: "#09203F",
						queryTextColor: "#FFFFFF"
				    }
			    }).open({
					left: (window.screen.width / 2) - (width / 2),
				    top: (window.screen.height / 2) - (height / 2)
			    });
				console.log(latitude + ", " + longitude)
			})
		</script>
	</div>
</body>
</html>