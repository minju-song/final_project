<!DOCTYPE html>
<html xmlns:th="https://www.thymeleaf.org/" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
    layout:decorate="~{layout/layout}">

<head>
    <meta charset="UTF-8">
    <title>Insert title here</title>
    <style>
        #myChart {
            width: 100%;
        }
    </style>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11.4.10/dist/sweetalert2.min.css">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.4.10/dist/sweetalert2.min.js"></script>
</head>

<body>
    <div layout:fragment="content">
        <h3>성공그래프</h3>
        <canvas id="myChart" height="400"></canvas>
        <canvas id="myChart2" height="400"></canvas>
        <select>
            <option>1주</option>
            <option>1달</option>
            <option>1년</option>

        </select>


        <script src="/user/js/Chart.min.js"></script>
        <!-- <script src="/user/js/utils.js"></script> -->
        <script th:inline="javascript">
            let club = /*[[${result.club}]]*/ null;
            let histories = /*[[${result.list}]]*/ null;
        </script>

        <script>
            let labelArr = [];
            let pctData = [];
            let backgroundColorArr = [];
            let borderColorArr = [];
            for (let i = 0; i < histories.length; i++) {
                console.log(histories[i]);
                if (dateFormat(histories[i].startDate) == dateFormat(histories[i].endDate)) {
                    labelArr[i] = dateFormat(histories[i].startDate);
                }
                else {
                    labelArr[i] = dateFormat(histories[i].startDate) + ' ~ ' + dateFormat(histories[i].endDate);
                }
                pctData[i] = histories[i].successPct;
                if (histories[i].successState == 'SU1') {
                    backgroundColorArr[i] = 'rgba(54, 162, 235, 0.2)';
                    borderColorArr[i] = 'rgba(54, 162, 235, 1)';
                }
                else {
                    backgroundColorArr[i] = 'rgba(255, 99, 132, 0.2)';
                    borderColorArr[i] = 'rgba(255, 99, 132, 1)';
                }
            }

            console.log(labelArr);

            $(document).ready(function () {
                var ctx = document.getElementById('myChart');
                var myChart = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: labelArr,
                        datasets: [{
                            label: '성공률',
                            data: pctData,
                            backgroundColor: backgroundColorArr,
                            borderColor: borderColorArr,
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: false,
                        scales: {
                            yAxes: [{
                                ticks: {
                                    beginAtZero: true
                                }
                            }]
                        },
                    }
                });
                // const DATA_COUNT = 7;
                // const NUMBER_CFG = { count: DATA_COUNT, min: 0, max: 100 };

                // const labels = [];
                // for (let i = 0; i < DATA_COUNT; ++i) {
                //     labels.push(Utils.newDate(i));
                // }


                // var ctx2 = document.getElementById('myChart2');
                // var myChart2 = new Chart(ctx, {
                //     labels: labels,
                //     datasets: [{
                //         type: 'line',
                //         label: 'Dataset 1',
                //         backgroundColor: Utils.transparentize(Utils.CHART_COLORS.red, 0.5),
                //         borderColor: Utils.CHART_COLORS.red,
                //         data: Utils.numbers(NUMBER_CFG),
                //     }, {
                //         type: 'bar',
                //         label: 'Dataset 2',
                //         backgroundColor: Utils.transparentize(Utils.CHART_COLORS.blue, 0.5),
                //         borderColor: Utils.CHART_COLORS.blue,
                //         data: Utils.numbers(NUMBER_CFG),
                //     }, {
                //         type: 'line',
                //         label: 'Dataset 3',
                //         backgroundColor: Utils.transparentize(Utils.CHART_COLORS.green, 0.5),
                //         borderColor: Utils.CHART_COLORS.green,
                //         fill: false,
                //         data: Utils.numbers(NUMBER_CFG),
                //     }]
                // })




            })


            function dateFormat(str) {
                let date = new Date(str);
                let newDate = date.getFullYear() + '-' + ((date.getMonth() + 1) <= 9 ? "0" + (date.getMonth() + 1) : (date.getMonth() + 1)) +
                    '-' + ((date.getDate()) <= 9 ? "0" + (date.getDate()) : (date.getDate()));
                return newDate;
            }
        </script>
    </div>
</body>

</html>