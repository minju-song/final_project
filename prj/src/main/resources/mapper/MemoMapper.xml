<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.holoyolo.app.memo.mapper.MemoMapper">
	<!-- 전체조회 -->
	<select id="selectMemoList" resultType="MemoVO">
		SELECT memo_id
				, seq_no
				, color
				, content
				, hash_tag
				, bookmark
				, write_date
				, update_date
				, member_id
		FROM memo
		WHERE member_id = #{memberId}
		ORDER BY seq_no
	</select>
	
	<!-- 단건조회 -->
	<select id="selectMemo" resultType="MemoVO">
		SELECT memo_id
				, seq_no
				, color
				, content
				, hash_tag
				, bookmark
				, write_date
				, update_date
				, member_id
		FROM memo
		WHERE memo_id = #{memoId}
		AND member_id = #{memberId}
	</select>
	
	<!-- 등록 -->
	<insert id="insertMemo" parameterType="MemoVO">
		<selectKey keyProperty="memoId,seqNo" resultType="MemoVO" order="BEFORE">
			SELECT NVL(MAX(memo_id),0) + 1 as memoId, NVL(MAX(seq_no),0) + 1 as seqNo
			FROM memo
		</selectKey>
		INSERT INTO memo
			(
				memo_id
				, seq_no
				<if test="color != ''">
					, color
				</if>
				<if test="content != ''">
					, content
				</if>
				<if test="hashTag != ''">
					, hash_tag
				</if>
				, bookmark
				, member_id
			)
		VALUES
			(
				#{memoId}
				, #{seqNo}
				<if test="color != ''">
					, #{color}
				</if>
				<if test="content != ''">
					, #{content}
				</if>
				<if test="hashTag != ''">
					, #{hashTag}
				</if>
				, #{bookmark}
				, #{memberId}
			)
	</insert>
	
	<!-- 수정 -->
	<update id="updateMemo" parameterType="MemoVO">
		UPDATE memo
			<set>
				<if test="seqNo > 0">
					seq_no = #{seqNo},
				</if>
				<if test="color != null and !color.equals('')">
					color = #{color},
				</if>
				<if test="content != null and !content.equals('')">
					content = #{content},
				</if>
				<if test="hashTag != null and !hashTag.equals('')">
					hash_tag = #{hashTag},
				</if>
				<if test="bookmark != null and !bookmark.equals('')">
					bookmark = #{bookmark},
				</if>
				update_date = sysdate
			</set>
		WHERE memo_id = #{memoId}
		AND member_id = #{memberId}
	</update>
	
	<!-- 삭제 -->
	<delete id="deleteMemo" parameterType="MemoVO">
		DELETE FROM memo
		WHERE memo_id = #{memoId}
		AND member_id = #{memberId}
	</delete>
</mapper>