<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
<mapper namespace="com.holoyolo.app.board.mapper.BoardMapper">
	

<select id="BoardList" resultType="BoardVO">
    <![CDATA[
    SELECT
        b.board_id, b.title, m.nickname, b.views, COUNT(blk.board_id) AS like_count, b.write_date
    FROM
        BOARD b
        JOIN member m ON b.member_id = m.member_id
        LEFT JOIN board_like blk ON b.board_id = blk.board_id
    WHERE
        b.menu_type = #{menuType}
    GROUP BY
        b.title, m.nickname, b.views, b.write_date, b.board_id
    ORDER BY
        b.write_date DESC
    ]]>
</select>


	<select id="selectBoard" resultType="BoardVO">
			SELECT * 
			FROM BOARD
			WHERE BOARD_ID= #{boardId}
	</select>

	<insert id="insertBoard" parameterType="BoardVO">
		<selectKey keyProperty="boardId"  resultType="int"  order="BEFORE">
	  		SELECT NVL(MAX(board_id),0) + 1
			FROM board
	  	</selectKey>
		INSERT INTO BOARD(BOARD_ID, MENU_TYPE, TITLE, CONTENT, WRITE_DATE, UPDATE_DATE, VIEWS, MEMBER_ID, CLUB_ID)
		VALUES (#{boardId}, #{menuType}, #{title}, #{content}, sysdate, null, 0,#{memberId}, null)
	</insert>
	
	<update id="">
	
	</update>
	
	<delete id="deleteBoard"></delete>



  <select id="searchBoardPaged" resultType="BoardVO" parameterType="int">
	    SELECT title, write_date, 
	    FROM BOARD
	    ORDER BY write_date
	    OFFSET #{start} ROWS FETCH NEXT #{end - start + 1} ROWS ONLY
</select>

<select id="getTotalBoardRecords" resultType="int" >
	SELECT COUNT(*)
    FROM BOARD
    WHERE MENU_TYPE = #{menuType}
    </select>
  
</mapper>

